<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klassenarbeiten-Designer</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel f√ºr JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }

        @media print {
            @page { margin: 0; size: A4; }
            body { background: white; }
            .print-hide { display: none !important; }
            .print-break-avoid { break-inside: avoid; }
            .preview-container { padding: 0 !important; background: white !important; }
            .a4-page { box-shadow: none !important; border: none !important; width: 100% !important; margin: 0 !important; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .line-pattern {
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 100% 25px;
        }

        .task-image-preview {
            max-height: 200px;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const App = () => {
            const [examData, setExamData] = useState({
                title: '1. Klassenarbeit',
                subject: 'Wirtschaftskunde',
                class: '10b',
                date: new Date().toLocaleDateString('de-DE'),
                teacher: 'Max Mustermann',
                logoUrl: '',
                situation: 'Stellen Sie sich vor, Sie sind Mitarbeiter in einem mittelst√§ndischen Unternehmen...',
                tasks: [
                    { 
                        id: 1, 
                        text: 'Nennen Sie vier Bestandteile eines ordnungsgem√§√üen Kaufvertrags.', 
                        points: 4, 
                        lineCount: 4,
                        taskImage: '',
                        taskLink: ''
                    },
                    { 
                        id: 2, 
                        text: 'Analysieren Sie die folgende Grafik zum Wirtschaftswachstum.', 
                        points: 6, 
                        lineCount: 6,
                        taskImage: '',
                        taskLink: ''
                    }
                ]
            });

            const [activeTab, setActiveTab] = useState('edit');
            const fileInputRef = useRef(null);
            const totalPoints = examData.tasks.reduce((sum, task) => sum + Number(task.points || 0), 0);

            const updateField = (field, value) => setExamData(prev => ({ ...prev, [field]: value }));
            
            const addTask = () => {
                const newTask = { 
                    id: Date.now(), 
                    text: '', 
                    points: 0, 
                    lineCount: 3, 
                    taskImage: '', 
                    taskLink: '' 
                };
                setExamData(prev => ({ ...prev, tasks: [...prev.tasks, newTask] }));
            };

            const removeTask = (id) => setExamData(prev => ({ ...prev, tasks: prev.tasks.filter(t => t.id !== id) }));

            const updateTask = (id, field, value) => {
                setExamData(prev => ({
                    ...prev,
                    tasks: prev.tasks.map(t => t.id === id ? { ...t, [field]: value } : t)
                }));
            };

            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => updateField('logoUrl', reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleTaskImageUpload = (id, e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => updateTask(id, 'taskImage', reader.result);
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="min-h-screen flex flex-col text-slate-900">
                    <header className="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center sticky top-0 z-50 print-hide shadow-sm">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-indigo-600 rounded-lg text-white font-bold text-xl">üìù</div>
                            <h1 className="text-lg font-extrabold tracking-tight">Klassenarbeiten-Designer</h1>
                        </div>
                        <div className="flex bg-slate-100 p-1 rounded-lg">
                            <button onClick={() => setActiveTab('edit')} className={`px-4 py-1.5 rounded-md text-sm font-semibold transition-all ${activeTab === 'edit' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500 hover:text-slate-700'}`}>Editor</button>
                            <button onClick={() => setActiveTab('preview')} className={`px-4 py-1.5 rounded-md text-sm font-semibold transition-all ${activeTab === 'preview' ? 'bg-white shadow-sm text-indigo-600' : 'text-slate-500 hover:text-slate-700'}`}>Vorschau</button>
                        </div>
                        <button onClick={() => window.print()} className="bg-indigo-600 text-white px-5 py-2 rounded-md hover:bg-indigo-700 shadow-md font-bold transition-transform active:scale-95">PDF Drucken</button>
                    </header>

                    <main className="flex-1 flex flex-col lg:flex-row overflow-hidden print:block">
                        {/* Sidebar / Editor */}
                        <aside className={`w-full lg:w-[450px] bg-white border-r border-slate-200 overflow-y-auto p-6 flex flex-col print-hide ${activeTab === 'preview' ? 'hidden' : 'block'}`}>
                            <div className="flex-1 space-y-8">
                                <section>
                                    <h2 className="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-[0.2em]">Allgemeine Infos</h2>
                                    <div className="space-y-3">
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-500 uppercase ml-1">Titel der Arbeit</label>
                                            <input type="text" value={examData.title} onChange={e => updateField('title', e.target.value)} className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500/20" />
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500 uppercase ml-1">Fach</label>
                                                <input type="text" value={examData.subject} onChange={e => updateField('subject', e.target.value)} className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500/20" />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500 uppercase ml-1">Klasse</label>
                                                <input type="text" value={examData.class} onChange={e => updateField('class', e.target.value)} className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500/20" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-500 uppercase ml-1">Lehrkraft</label>
                                            <input type="text" value={examData.teacher} onChange={e => updateField('teacher', e.target.value)} className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500/20 font-medium" />
                                        </div>
                                        <div className="mt-4 border-2 border-dashed border-slate-200 p-4 text-center cursor-pointer rounded-xl bg-slate-50 hover:bg-indigo-50 hover:border-indigo-200 transition-all group" onClick={() => fileInputRef.current.click()}>
                                            {examData.logoUrl ? <img src={examData.logoUrl} className="h-12 mx-auto mb-2" /> : <div className="text-xl mb-1 opacity-50">üñºÔ∏è</div>}
                                            <p className="text-[10px] font-bold text-slate-400 group-hover:text-indigo-500">Schullogo hochladen</p>
                                            <input ref={fileInputRef} type="file" className="hidden" onChange={handleLogoUpload} />
                                        </div>
                                    </div>
                                </section>

                                <section>
                                    <h2 className="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-[0.2em]">Handlungssituation</h2>
                                    <textarea rows="3" value={examData.situation} onChange={e => updateField('situation', e.target.value)} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-indigo-500/20 leading-relaxed" placeholder="Kontext beschreiben..." />
                                </section>

                                <section className="pb-10">
                                    <div className="flex justify-between items-end mb-4">
                                        <h2 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Aufgaben</h2>
                                        <span className="text-xs font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full border border-indigo-100 shadow-sm">{totalPoints} Pkt. gesamt</span>
                                    </div>
                                    <div className="space-y-6">
                                        {examData.tasks.map((task, index) => (
                                            <div key={task.id} className="p-4 bg-slate-50 border border-slate-200 rounded-xl relative group shadow-sm hover:shadow-md transition-shadow">
                                                <button onClick={() => removeTask(task.id)} className="absolute top-3 right-3 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-1">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
                                                </button>
                                                <div className="text-[10px] font-black text-indigo-500 mb-2 uppercase tracking-wider">Aufgabe {index + 1}</div>
                                                <textarea value={task.text} onChange={e => updateTask(task.id, 'text', e.target.value)} className="w-full p-2 text-sm border border-slate-200 rounded-lg bg-white mb-3 outline-none focus:ring-2 focus:ring-indigo-500/20 font-medium" placeholder="Fragestellung..." rows="2" />
                                                
                                                <div className="grid grid-cols-2 gap-3 mb-4">
                                                    <div>
                                                        <label className="text-[9px] uppercase font-black text-slate-400 block mb-1">Punkte</label>
                                                        <input type="number" value={task.points} onChange={e => updateTask(task.id, 'points', e.target.value)} className="w-full p-2 text-xs border border-slate-200 rounded-lg font-bold" />
                                                    </div>
                                                    <div>
                                                        <label className="text-[9px] uppercase font-black text-slate-400 block mb-1">Anzahl Zeilen</label>
                                                        <div className="flex items-center gap-2">
                                                            <button onClick={() => updateTask(task.id, 'lineCount', Math.max(0, task.lineCount - 1))} className="w-8 h-8 flex items-center justify-center bg-white border border-slate-200 rounded-lg hover:bg-slate-100 text-xs font-bold">-</button>
                                                            <input type="number" value={task.lineCount} onChange={e => updateTask(task.id, 'lineCount', parseInt(e.target.value) || 0)} className="flex-1 p-2 text-xs border border-slate-200 rounded-lg text-center font-bold" />
                                                            <button onClick={() => updateTask(task.id, 'lineCount', task.lineCount + 1)} className="w-8 h-8 flex items-center justify-center bg-white border border-slate-200 rounded-lg hover:bg-slate-100 text-xs font-bold">+</button>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Optionale Medien-Sektion f√ºr Aufgaben */}
                                                <div className="space-y-3 pt-3 border-t border-slate-200">
                                                    <div>
                                                        <label className="text-[9px] uppercase font-black text-slate-500 block mb-1">Optionale Grafik / Bild</label>
                                                        <div className="flex items-center gap-2">
                                                            <input 
                                                                type="file" 
                                                                accept="image/*" 
                                                                id={`img-${task.id}`}
                                                                className="hidden" 
                                                                onChange={(e) => handleTaskImageUpload(task.id, e)} 
                                                            />
                                                            <label htmlFor={`img-${task.id}`} className="flex-1 cursor-pointer bg-white border border-slate-200 rounded-lg p-2 text-[10px] text-center font-bold text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                                                                {task.taskImage ? "Bild √§ndern" : "Bild hochladen"}
                                                            </label>
                                                            {task.taskImage && (
                                                                <button onClick={() => updateTask(task.id, 'taskImage', '')} className="p-2 text-red-500 hover:bg-red-50 rounded-lg border border-red-100">
                                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M18 6L6 18M6 6l12 12"/></svg>
                                                                </button>
                                                            )}
                                                        </div>
                                                        {task.taskImage && <img src={task.taskImage} className="mt-2 h-16 w-full object-cover rounded-lg border border-slate-200" />}
                                                    </div>
                                                    <div>
                                                        <label className="text-[9px] uppercase font-black text-slate-500 block mb-1">Optionaler Link (URL)</label>
                                                        <input 
                                                            type="text" 
                                                            value={task.taskLink} 
                                                            onChange={e => updateTask(task.id, 'taskLink', e.target.value)} 
                                                            className="w-full p-2 text-[10px] border border-slate-200 rounded-lg bg-white outline-none focus:ring-1 focus:ring-indigo-500" 
                                                            placeholder="https://..."
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={addTask} className="w-full mt-6 py-4 border-2 border-dashed border-slate-200 rounded-xl text-sm font-bold text-slate-400 hover:text-indigo-600 hover:border-indigo-200 hover:bg-indigo-50 transition-all flex items-center justify-center gap-2">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14M5 12h14"/></svg>
                                        Neue Aufgabe hinzuf√ºgen
                                    </button>
                                </section>
                            </div>

                            <footer className="mt-8 pt-6 border-t border-slate-100 text-[10px] text-slate-400">
                                <p className="mb-2 font-black uppercase tracking-widest opacity-50 text-[8px]">Lizenz</p>
                                <div className="flex items-start gap-3">
                                    <div className="flex-1 leading-relaxed">
                                        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.de" target="_blank" className="text-indigo-500 hover:underline font-bold">CC BY-NC-SA 4.0 Lizenz</a>.<br/>
                                        &copy; {new Date().getFullYear()} {examData.teacher || 'Urheber'}
                                    </div>
                                    <img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg" className="w-14 grayscale opacity-40" alt="CC BY-NC-SA" />
                                </div>
                            </footer>
                        </aside>

                        {/* Preview / A4 Sheet */}
                        <section className={`flex-1 bg-slate-200 p-4 md:p-12 overflow-y-auto preview-container print:bg-white print:p-0 ${activeTab === 'edit' ? 'hidden lg:block' : 'block'}`}>
                            <div className="a4-page mx-auto bg-white shadow-2xl min-h-[29.7cm] w-[21cm] p-[2cm] print:shadow-none print:w-full box-border border border-slate-300 print:border-none relative">
                                
                                {/* Header Section */}
                                <div className="flex justify-between items-start border-b-2 border-slate-900 pb-6 mb-8">
                                    <div className="flex-1">
                                        <div className="grid grid-cols-2 gap-x-12 gap-y-3 text-[9px] mb-6 uppercase font-bold tracking-wider text-slate-500">
                                            <div className="border-b-2 border-slate-900 h-9 flex flex-col justify-between pb-1">
                                                <span>Name:</span>
                                            </div>
                                            <div className="border-b border-slate-300 h-9 flex flex-col justify-between pb-1">
                                                <span>Datum:</span>
                                                <span className="text-slate-900 text-xs font-black">{examData.date}</span>
                                            </div>
                                            <div className="border-b border-slate-300 h-9 flex flex-col justify-between pb-1">
                                                <span>Klasse:</span>
                                                <span className="text-slate-900 text-xs font-black">{examData.class}</span>
                                            </div>
                                            <div className="border-b border-slate-300 h-9 flex flex-col justify-between pb-1">
                                                <span>Lehrkraft:</span>
                                                <span className="text-slate-900 text-xs font-black">{examData.teacher}</span>
                                            </div>
                                        </div>
                                        <h2 className="text-2xl font-[900] uppercase tracking-tighter leading-none text-slate-900">{examData.title}</h2>
                                        <div className="text-lg text-slate-500 font-medium italic mt-1">{examData.subject}</div>
                                    </div>
                                    {examData.logoUrl && <img src={examData.logoUrl} className="max-h-20 max-w-[4cm] object-contain ml-6" />}
                                </div>

                                {/* Situation Section */}
                                {examData.situation && (
                                    <div className="mb-8 p-5 bg-slate-50 border-l-4 border-slate-400 rounded-r-xl">
                                        <span className="font-black text-[9px] uppercase mb-2 block tracking-[0.15em] text-slate-400">Handlungssituation:</span>
                                        <p className="text-[13px] leading-relaxed italic text-slate-700">{examData.situation}</p>
                                    </div>
                                )}

                                {/* Tasks Section */}
                                <div className="space-y-10">
                                    {examData.tasks.map((task, index) => (
                                        <div key={task.id} className="print-break-avoid">
                                            <div className="flex justify-between items-start mb-2">
                                                <div className="flex-1 text-[14px] leading-snug">
                                                    <span className="font-[900] mr-2 text-base inline-block border-b-2 border-indigo-500">Aufgabe {index + 1}</span> 
                                                    <span className="font-medium text-slate-800">{task.text || "..."}</span>
                                                </div>
                                                <div className="flex flex-col items-center ml-4">
                                                    <span className="text-[7px] font-black uppercase text-slate-400 mb-1">Punkte</span>
                                                    <div className="border-2 border-slate-900 px-2 py-0.5 font-black text-xs min-w-[45px] text-center bg-white">/ {task.points}</div>
                                                </div>
                                            </div>
                                            
                                            {/* Aufgabe Medien (Bild & Link) */}
                                            {(task.taskImage || task.taskLink) && (
                                                <div className="my-4 space-y-2">
                                                    {task.taskImage && (
                                                        <img src={task.taskImage} className="task-image-preview block rounded border border-slate-100 mx-auto max-w-full" alt={`Grafik zu Aufgabe ${index + 1}`} />
                                                    )}
                                                    {task.taskLink && (
                                                        <div className="text-[10px] text-indigo-600 flex items-center gap-1 font-medium bg-indigo-50/50 p-1 px-2 rounded w-fit italic">
                                                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                                                            Quelle/Link: {task.taskLink}
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {/* Schreiblinien */}
                                            {task.lineCount > 0 && (
                                                <div className="mt-3 border-t border-slate-200 line-pattern" style={{ height: `${task.lineCount * 25}px` }}></div>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                {/* Summary Footer */}
                                <div className="mt-16 pt-8 border-t-2 border-slate-900 grid grid-cols-2 gap-10">
                                    <div className="flex flex-col justify-end pb-1">
                                        <span className="text-[10px] italic font-medium text-slate-400">Viel Erfolg!</span>
                                    </div>
                                    <div className="flex flex-col gap-3">
                                        <div className="flex items-center justify-between bg-slate-900 text-white p-3 rounded-lg">
                                            <span className="font-black text-[9px] uppercase tracking-widest">Gesamtpunkte:</span>
                                            <div className="font-black text-xl">/ {totalPoints}</div>
                                        </div>
                                        <div className="flex items-center justify-between border-2 border-slate-900 p-3 rounded-lg">
                                            <span className="font-black text-[9px] uppercase tracking-widest">Note:</span>
                                            <div className="w-10 h-5"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="hidden print:block absolute bottom-4 left-[2cm] right-[2cm] flex justify-between text-[7px] text-slate-300 font-bold uppercase tracking-widest pt-2 border-t border-slate-50">
                                    <span>Designer: {examData.teacher}</span>
                                    <span>Lizenz: CC BY-NC-SA 4.0</span>
                                </div>
                            </div>
                        </section>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>